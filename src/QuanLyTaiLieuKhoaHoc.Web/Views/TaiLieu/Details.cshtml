@model QuanLyTaiLieuKhoaHoc.Web.Models.ViewModels.TaiLieuViewModel
@{
    ViewData["Title"] = $"Chi tiết: {Model.TenTaiLieu}";
}

<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="/TaiLieu">Tài liệu</a></li>
            <li class="breadcrumb-item active">@Model.TenTaiLieu</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title mb-0">@Model.TenTaiLieu</h1>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Người tải lên:</strong> @Model.TacGia
                        </div>
                        <div class="col-md-6">
                            <strong>Ngày tải lên:</strong> @Model.NgayTaiLen.ToString("dd/MM/yyyy HH:mm")
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Chuyên ngành:</strong>
                            <span class="badge bg-success">@Model.TenChuyenNganh</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Loại tài liệu:</strong>
                            <span class="badge bg-primary">@Model.TenLoaiTaiLieu</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Lượt mượn:</strong> @Model.LuotMuon
                        </div>
                        <div class="col-md-6">
                            <strong>Kích thước:</strong> @((Model.KichThuocFile / 1024).ToString("F1")) KB
                        </div>
                    </div>
                    @* @if (Model.SoLuotDanhGia > 0)
                    {
                        <div class="row mb-3">
                            <div class="col-12">
                                <strong>Đánh giá:</strong>
                                <span class="text-warning">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= Model.DiemDanhGiaTrungBinh)
                                        {
                                            <i class="fas fa-star"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-star"></i>
                                        }
                                    }
                                </span>
                                (@Model.DiemDanhGiaTrungBinh.ToString("F1")/5 - @Model.SoLuotDanhGia đánh giá)
                            </div>
                        </div>
                    } *@
                    <div class="mb-4">
                        <h5>Mô tả:</h5>
                        <p class="text-muted">@Model.MoTa</p>
                    </div>
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="d-flex gap-2">
                            @if (User.IsInRole("GiangVien"))
                            {
                                if (Model.ChoPhepTaiFile)
                                {
                                    <a href="/TaiLieu/Download/@Model.MaTaiLieu" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i>Tải xuống
                                    </a>
                                }
                                else
                                {
                                    <a href="/TaiLieu/View/@Model.MaTaiLieu" class="btn btn-secondary">
                                        <i class="fas fa-eye me-2"></i>Xem
                                    </a>
                                }
                            }
                            else if (User.IsInRole("SinhVien"))
                            {
                                if (Model.ChoPhepTaiFile)
                                {
                                    <a href="/TaiLieu/Download/@Model.MaTaiLieu" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i>Tải xuống
                                    </a>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-success" data-bs-toggle="modal"
                                        data-bs-target="#muonModal">
                                        <i class="fas fa-paper-plane me-2"></i>Gửi yêu cầu mượn
                                    </button>
                                }
                            }
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <a asp-controller="Account" asp-action="Login">Đăng nhập</a> để xem tài liệu.
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Tài liệu liên quan</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Các tài liệu cùng chuyên ngành sẽ hiển thị ở đây.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Rating Modal -->
@* @if (User.Identity?.IsAuthenticated == true)
{
    <div class="modal fade" id="ratingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="/TaiLieu/Rate">
                    <div class="modal-header">
                        <h5 class="modal-title">Đánh giá tài liệu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="MaTaiLieu" value="@Model.MaTaiLieu" />
                        <div class="mb-3">
                            <label class="form-label">Điểm đánh giá:</label>
                            <div class="rating">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <input type="radio" name="DiemDanhGia" value="@i" id="star@i" />
                                    <label for="star@i" class="star">
                                        <i class="fas fa-star"></i>
                                    </label>
                                }
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="nhanXet" class="form-label">Nhận xét:</label>
                            <textarea class="form-control" id="nhanXet" name="NhanXet" rows="3"
                            placeholder="Chia sẻ ý kiến của bạn về tài liệu này..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
} *@

@* <style>
    .rating {
        direction: rtl;
        display: inline-block;
    }

    .rating input {
        display: none;
    }

    .rating label {
        color: #ddd;
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.2s;
    }

    .rating label:hover,
    .rating label:hover~label,
    .rating input:checked~label {
        color: #ffc107;
    }
</style> *@

<!-- Modal Gửi Yêu Cầu Mượn -->
<div class="modal fade" id="muonModal" tabindex="-1" aria-labelledby="muonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="GuiYeuCauMuon" asp-controller="TaiLieu" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="muonModalLabel">Gửi yêu cầu mượn tài liệu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="maTaiLieu" value="@Model.MaTaiLieu" />
                    <div class="mb-3">
                        <label for="ngayMuon" class="form-label">Ngày giờ đến thư viện mượn</label>
                        <input type="datetime-local" class="form-control" id="ngayMuon" name="ngayMuon" required />
                    </div>
                    <div class="mb-3">
                        <label for="lyDo" class="form-label">Lý do mượn</label>
                        <textarea class="form-control" id="lyDo" name="lyDo" rows="2" placeholder="Nhập lý do mượn..."
                            required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-paper-plane me-2"></i>Gửi yêu cầu mượn
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
