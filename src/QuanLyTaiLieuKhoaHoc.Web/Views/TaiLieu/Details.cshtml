@model QuanLyTaiLieuKhoaHoc.Web.Models.ViewModels.TaiLieuViewModel
@{
    ViewData["Title"] = $"Chi tiết: {Model.TenTaiLieu}";
}

<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="/TaiLieu">Tài liệu</a></li>
            <li class="breadcrumb-item active">@Model.TenTaiLieu</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title mb-0">@Model.TenTaiLieu</h1>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Người tải lên:</strong> @Model.TacGia
                        </div>
                        <div class="col-md-6">
                            <strong>Ngày tải lên:</strong> @Model.NgayTaiLen.ToString("dd/MM/yyyy HH:mm")
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Chuyên ngành:</strong>
                            <span class="badge bg-success">@Model.TenChuyenNganh</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Loại tài liệu:</strong>
                            <span class="badge bg-primary">@Model.TenLoaiTaiLieu</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Lượt mượn:</strong> @Model.LuotMuon
                        </div>
                        <div class="col-md-6">
                            <strong>Kích thước:</strong> @((Model.KichThuocFile / 1024).ToString("F1")) KB
                        </div>
                    </div>
                    @if (Model.ChoPhepTaiFile)
                    {
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>Lượt tải:</strong> @Model.LuotTai
                            </div>
                        </div>
                    }
                    <div class="mb-4">
                        <h5>Mô tả:</h5>
                        <p class="text-muted">@Model.MoTa</p>
                    </div>
                    @* Hiển thị thông tin chuyên biệt theo loại tài liệu *@
                    @if (Model.TenLoaiTaiLieu != null && Model.TenLoaiTaiLieu.Contains("báo", System.StringComparison.OrdinalIgnoreCase)) {
                        <div class="mb-4 p-3 border rounded bg-light">
                            <h5 class="mb-3 text-primary">
                                <i class="fas fa-newspaper me-2"></i>Thông tin Bài báo khoa học
                            </h5>
                            <table class="table table-sm table-borderless mb-0">
                                <tr><th>Tiêu đề:</th><td>@Model.TieuDe</td></tr>
                                <tr><th>Tạp chí/Hội nghị:</th><td>@Model.TapChiHoiNghi</td></tr>
                                <tr><th>Ngày công bố:</th><td>@(Model.NgayCongBo?.ToString("dd/MM/yyyy") ?? "")</td></tr>
                                <tr><th>DOI:</th><td>@Model.DOI</td></tr>
                                <tr><th>ISSN:</th><td>@Model.ISSN</td></tr>
                                <tr><th>Cấp độ:</th><td>@Model.CapDo</td></tr>
                            </table>
                        </div>
                    }
                    else if (Model.TenLoaiTaiLieu != null && Model.TenLoaiTaiLieu.Contains("đề tài", System.StringComparison.OrdinalIgnoreCase)) {
                        <div class="mb-4 p-3 border rounded bg-light">
                            <h5 class="mb-3 text-success">
                                <i class="fas fa-project-diagram me-2"></i>Thông tin Đề tài nghiên cứu khoa học
                            </h5>
                            <table class="table table-sm table-borderless mb-0">
                                <tr><th>Tên đề tài:</th><td>@Model.TenDeTai</td></tr>
                                <tr><th>Mã số đề tài:</th><td>@Model.MaSoDeTai</td></tr>
                                <tr><th>Cấp đề tài:</th><td>@Model.CapDeTai</td></tr>
                                <tr><th>Thời gian thực hiện:</th><td>@Model.ThoiGianThucHien</td></tr>
                                <tr><th>Cơ quan chủ trì:</th><td>@Model.CoQuanChuTri</td></tr>
                                <tr><th>Chủ nhiệm đề tài:</th><td>@Model.ChuNhiemDeTai</td></tr>
                            </table>
                        </div>
                    }
                    else if (Model.TenLoaiTaiLieu != null && (Model.TenLoaiTaiLieu.Contains("giáo trình", System.StringComparison.OrdinalIgnoreCase) || Model.TenLoaiTaiLieu.Contains("giảng dạy", System.StringComparison.OrdinalIgnoreCase))) {
                        <div class="mb-4 p-3 border rounded bg-light">
                            <h5 class="mb-3 text-warning">
                                <i class="fas fa-book me-2"></i>Thông tin Giáo trình - Tài liệu giảng dạy
                            </h5>
                            <table class="table table-sm table-borderless mb-0">
                                <tr><th>Tên giáo trình:</th><td>@Model.TenGiaoTrinh</td></tr>
                                <tr><th>Môn học liên quan:</th><td>@Model.MonHocLienQuan</td></tr>
                                <tr><th>Đơn vị phát hành:</th><td>@Model.DonViPhatHanh</td></tr>
                                <tr><th>Năm xuất bản:</th><td>@Model.NamXuatBan</td></tr>
                                <tr><th>Số tín chỉ:</th><td>@Model.SoTinChi</td></tr>
                            </table>
                        </div>
                    }
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="d-flex gap-2">
                            @if (User.IsInRole("GiangVien"))
                            {
                                if (Model.ChoPhepTaiFile)
                                {
                                    <a href="/TaiLieu/Download/@Model.MaTaiLieu" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i>Tải xuống
                                    </a>
                                }
                                <form asp-action="ThemYeuThich" asp-controller="TaiLieu" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="maTaiLieu" value="@Model.MaTaiLieu" />
                                        <button type="submit" class="btn btn-outline-danger">
                                        <i class="fas fa-heart me-2"></i>Yêu thích
                                        </button>
                                        </form>
                            }
                            else if (User.IsInRole("SinhVien"))
                            {
                                if (Model.ChoPhepTaiFile)
                                {
                                    <a href="/TaiLieu/Download/@Model.MaTaiLieu" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i>Tải xuống
                                    </a>

                                    <form asp-action="ThemYeuThich" asp-controller="TaiLieu" method="post" class="d-inline">
                                        
                                    
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="maTaiLieu" value="@Model.MaTaiLieu" />
                                        <button type="submit" class="btn btn-outline-danger">
                                        <i class="fas fa-heart me-2"></i>Yêu thích
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-success" data-bs-toggle="modal"
                                        data-bs-target="#muonModal">
                                        <i class="fas fa-paper-plane me-2"></i>Gửi yêu cầu mượn
                                    </button>

                                    <form asp-action="ThemYeuThich" asp-controller="TaiLieu" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="maTaiLieu" value="@Model.MaTaiLieu" />
                                        <button type="submit" class="btn btn-outline-danger">
                                        <i class="fas fa-heart me-2"></i>Yêu thích
                                        </button>
                                    </form>
                                }
                            }
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <a asp-controller="Account" asp-action="Login">Đăng nhập</a> để xem tài liệu.
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Tài liệu liên quan</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Các tài liệu cùng chuyên ngành sẽ hiển thị ở đây.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal Gửi Yêu Cầu Mượn -->
<div class="modal fade" id="muonModal" tabindex="-1" aria-labelledby="muonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="GuiYeuCauMuon" asp-controller="TaiLieu" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="muonModalLabel">Gửi yêu cầu mượn tài liệu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="maTaiLieu" value="@Model.MaTaiLieu" />
                    <div class="mb-3">
                        <label for="ngayMuon" class="form-label">Ngày giờ đến thư viện mượn</label>
                        <input type="datetime-local" class="form-control" id="ngayMuon" name="ngayMuon" required />
                    </div>
                    <div class="mb-3">
                        <label for="lyDo" class="form-label">Lý do mượn</label>
                        <textarea class="form-control" id="lyDo" name="lyDo" rows="2" placeholder="Nhập lý do mượn..."
                            required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-paper-plane me-2"></i>Gửi yêu cầu mượn
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
