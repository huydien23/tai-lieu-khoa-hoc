@model TaiLieuListViewModel

@{
    var action = ViewBag.SearchAction as string ?? "Index";
    var controller = ViewBag.SearchController as string ?? "TaiLieu";
}

<div class="enhanced-search-form">
    <form method="get" asp-action="@action" asp-controller="@controller" class="search-form" id="searchForm">
        <div class="search-container">
            <!-- Main Search Bar -->
            <div class="search-main">
                <div class="search-input-wrapper">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" 
                           name="timKiem" 
                           id="timKiem"
                           class="search-input"
                           value="@(Model?.TimKiem ?? ViewBag.TimKiem)"
                           placeholder="Tìm kiếm tài liệu khoa học..."
                           autocomplete="off">
                    <div class="search-actions">
                        <button type="button" class="btn-clear" id="clearSearch" title="Xóa tìm kiếm">
                            <i class="fas fa-times"></i>
                        </button>
                        <button type="submit" class="btn-search" id="searchButton">
                            <i class="fas fa-search"></i>
                            <span>Tìm kiếm</span>
                        </button>
                    </div>
                </div>
                
                <!-- Search Suggestions -->
                <div class="search-suggestions" id="searchSuggestions" style="display: none;">
                    <!-- Suggestions will be populated by JavaScript -->
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="search-filters">
                <div class="filters-row">
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-graduation-cap me-2"></i>
                            Chuyên ngành
                        </label>
                        <select name="maChuyenNganh" class="filter-select">
                            <option value="">Tất cả chuyên ngành</option>
                            @if (ViewBag.ChuyenNganh != null)
                            {
                                @foreach (var item in ViewBag.ChuyenNganh as SelectList ?? new SelectList(new List<object>()))
                                {
                                    <option value="@item.Value" selected="@(item.Selected)">
                                        @item.Text
                                    </option>
                                }
                            }
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-file-alt me-2"></i>
                            Loại tài liệu
                        </label>
                        <select name="maLoaiTaiLieu" class="filter-select">
                            <option value="">Tất cả loại</option>
                            @if (ViewBag.LoaiTaiLieu != null)
                            {
                                @foreach (var item in ViewBag.LoaiTaiLieu as SelectList ?? new SelectList(new List<object>()))
                                {
                                    // Ẩn option "Giáo trình" nếu là Sinh viên
                                    if (User.IsInRole("SinhVien") && item.Text.Contains("Giáo trình"))
                                    {
                                        continue;
                                    }
                                    <option value="@item.Value" selected="@(item.Selected)">
                                        @item.Text
                                    </option>
                                }
                            }
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-sort me-2"></i>
                            Sắp xếp
                        </label>
                        <select name="sapXep" class="filter-select">
                            <option value="moiNhat" selected="@(Model?.SapXep == "moiNhat")">Mới nhất</option>
                            <option value="phoBien" selected="@(Model?.SapXep == "phoBien")">Phổ biến nhất</option>
                            <option value="danhGia" selected="@(Model?.SapXep == "danhGia")">Đánh giá cao</option>
                            <option value="tenAZ" selected="@(Model?.SapXep == "tenAZ")">Tên A-Z</option>
                        </select>
                    </div>

                    <div class="filter-actions">
                        <button type="button" class="btn-filter-toggle" id="toggleFilters">
                            <i class="fas fa-filter"></i>
                            <span>Bộ lọc</span>
                        </button>
                        <a asp-action="Index" asp-controller="@controller" class="btn-reset" title="Làm mới">
                            <i class="fas fa-refresh"></i>
                        </a>
                    </div>
                </div>

                <!-- Additional Filters (Collapsible) -->
                <div class="additional-filters" id="additionalFilters" style="display: none;">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar me-2"></i>
                                Năm xuất bản
                            </label>
                            <select name="namXuatBan" class="filter-select">
                                <option value="">Tất cả năm</option>
                                @for (int year = DateTime.Now.Year; year >= 2010; year--)
                                {
                                    <option value="@year">@year</option>
                                }
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-user me-2"></i>
                                Tác giả
                            </label>
                            <input type="text" name="tacGia" class="filter-input" placeholder="Nhập tên tác giả...">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-star me-2"></i>
                                Đánh giá tối thiểu
                            </label>
                            <select name="danhGiaMin" class="filter-select">
                                <option value="">Tất cả</option>
                                <option value="4">4+ sao</option>
                                <option value="3">3+ sao</option>
                                <option value="2">2+ sao</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div class="active-filters" id="activeFilters" style="display: none;">
                <div class="active-filters-label">
                    <i class="fas fa-tags me-2"></i>
                    Bộ lọc đang áp dụng:
                </div>
                <div class="active-filter-tags" id="activeFilterTags">
                    <!-- Active filter tags will be populated by JavaScript -->
                </div>
                <button type="button" class="btn-clear-all" id="clearAllFilters">
                    <i class="fas fa-times me-1"></i>
                    Xóa tất cả
                </button>
            </div>
        </div>
    </form>
</div>
