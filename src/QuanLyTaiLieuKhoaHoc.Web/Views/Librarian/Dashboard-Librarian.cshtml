@model QuanLyTaiLieuKhoaHoc.Web.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard Thủ thư";
}

@functions {
    public string GetTimeAgo(DateTime time)
    {
        var timeSpan = DateTime.Now - time;
        
        if (timeSpan.TotalMinutes < 1)
            return "Vừa xong";
        else if (timeSpan.TotalMinutes < 60)
            return $"{(int)timeSpan.TotalMinutes} phút trước";
        else if (timeSpan.TotalHours < 24)
            return $"{(int)timeSpan.TotalHours} giờ trước";
        else
            return $"{(int)timeSpan.TotalDays} ngày trước";
    }
}

<!-- Modern Dashboard Header -->
<div class="modern-header">
    <div class="header-background">
        <div class="header-content">
            <div class="header-left">
                <div class="header-icon">
                    <i class="fas fa-book-reader"></i>
                </div>
                <div class="header-text">
                    <h1 class="header-title">Dashboard Thủ thư</h1>
                    <p class="header-subtitle">Quản lý & giám sát tài liệu khoa học</p>
                </div>
            </div>
            <div class="header-right">
                <div class="header-info">
                    <div class="current-time">
                        <i class="fas fa-clock me-2"></i>
                        <span id="currentDateTime">@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span>
                    </div>
                    <div class="user-info">
                        <span class="user-name">Thủ thư</span>
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <a href="@Url.Action("Logout", "Account")" class="logout-btn" title="Đăng xuất">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Grid Layout 2x2 -->
<div class="dashboard-grid">
    <!-- Top Left: Hoạt động hôm nay -->
    <div class="dashboard-section">
        <div class="section-header">
            <h5 class="section-title">
                <i class="fas fa-chart-line me-2"></i>
                Hoạt động hôm nay
            </h5>
        </div>
        <div class="activity-cards">
            <div class="activity-card">
                <div class="activity-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-number">1</div>
                    <div class="activity-label">ĐÃ MƯỢN</div>
                </div>
            </div>
            <div class="activity-card">
                <div class="activity-icon">
                    <i class="fas fa-undo"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-number">0</div>
                    <div class="activity-label">ĐÃ TRẢ</div>
                </div>
            </div>
            <div class="activity-card">
                <div class="activity-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-number">0</div>
                    <div class="activity-label">CHỜ DUYỆT</div>
                </div>
            </div>
            <div class="activity-card">
                <div class="activity-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-number">0</div>
                    <div class="activity-label">ĐANG ONLINE</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Right: Thống kê nhanh -->
    <div class="dashboard-section">
        <div class="section-header">
            <h5 class="section-title">
                <i class="fas fa-list me-2"></i>
                Thống kê nhanh
            </h5>
        </div>
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@Model.TongSoTaiLieu</div>
                    <div class="stat-label">Tổng tài liệu</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@Model.TongSoNguoiDung</div>
                    <div class="stat-label">Tổng người dùng</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@Model.TongSoLuotMuon</div>
                    <div class="stat-label">Lượt mượn tháng</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Left: Tài liệu cần xử lý -->
    <div class="dashboard-section">
        <div class="section-header">
            <h5 class="section-title">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Tài liệu cần xử lý
            </h5>
        </div>
        <div class="process-cards">
            <div class="process-card overdue">
                <div class="process-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="process-content">
                    <div class="process-number">1</div>
                    <div class="process-label">QUÁ HẠN</div>
                </div>
            </div>
            <div class="process-card pending">
                <div class="process-icon">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="process-content">
                    <div class="process-number">0</div>
                    <div class="process-label">CHỜ DUYỆT</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Right: Hoạt động hệ thống -->
    <div class="dashboard-section">
        <div class="section-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="section-title">
                    <i class="fas fa-bell me-2"></i>
                    Hoạt động hệ thống
                </h5>
                <a href="#" class="view-all-link">Xem tất cả</a>
            </div>
        </div>
        <div class="system-activities">
            @if (Model.HoạtĐộngHệThống?.Any() == true)
            {
                @foreach (var activity in Model.HoạtĐộngHệThống.Take(3))
                {
                    var iconClass = activity.LoạiHoạtĐộng switch
                    {
                        ActivityType.NgườiDùngMớiĐăngKý => "fas fa-user text-primary",
                        ActivityType.YêuCầuMượnTàiLiệu => "fas fa-book text-warning",
                        ActivityType.TàiLiệuĐượcTrả => "fas fa-undo text-info",
                        ActivityType.CảnhBáoQuáHạn => "fas fa-clock text-warning",
                        ActivityType.TàiLiệuQuáHạn => "fas fa-exclamation-triangle text-danger",
                        ActivityType.TàiLiệuMớiĐượcThêm => "fas fa-file-alt text-primary",
                        ActivityType.ThốngKêHoạtĐộng => "fas fa-chart-line text-success",
                        _ => "fas fa-bell text-primary"
                    };

                    var timeAgo = GetTimeAgo(activity.ThờiGian);

                    <div class="system-activity">
                        <div class="activity-icon-small">
                            <i class="@iconClass"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">@activity.TiêuĐề</div>
                            <div class="activity-time">@timeAgo</div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-activities">
                    <i class="fas fa-bell fa-2x mb-2"></i>
                    <p>Không có hoạt động nào</p>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 1.5rem;
        margin-top: 2rem;
        height: calc(100vh - 200px);
    }

    .dashboard-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    .section-header {
        margin-bottom: 1rem;
    }

    .section-title {
        color: #1e40af;
        font-weight: 600;
        margin: 0;
        font-size: 1.1rem;
    }

    .view-all-link {
        color: #3b82f6;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .view-all-link:hover {
        color: #1d4ed8;
        text-decoration: underline;
    }

    /* Hoạt động hôm nay */
    .activity-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 1rem;
        flex: 1;
    }

    .activity-card {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border: 1px solid #e2e8f0;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        background: #3b82f6;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .activity-content {
        flex: 1;
    }

    .activity-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e40af;
        line-height: 1;
    }

    .activity-label {
        font-size: 0.8rem;
        color: #64748b;
        font-weight: 600;
        margin-top: 0.25rem;
    }

    /* Thống kê nhanh */
    .stats-cards {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1;
    }

    .stat-card {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        border: 1px solid #e2e8f0;
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        background: #3b82f6;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .stat-content {
        flex: 1;
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        color: #1e40af;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.9rem;
        color: #374151;
        margin-top: 0.25rem;
    }

    /* Tài liệu cần xử lý */
    .process-cards {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1;
    }

    .process-card {
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        color: white;
    }

    .process-card.overdue {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .process-card.pending {
        background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .process-icon {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .process-content {
        flex: 1;
    }

    .process-number {
        font-size: 1.8rem;
        font-weight: 700;
        line-height: 1;
    }

    .process-label {
        font-size: 0.9rem;
        font-weight: 600;
        margin-top: 0.25rem;
        opacity: 0.9;
    }

    /* Hoạt động hệ thống */
    .system-activities {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
    }

    .system-activity {
        background: #f8fafc;
        border-radius: 8px;
        padding: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border: 1px solid #e2e8f0;
    }

    .activity-icon-small {
        width: 32px;
        height: 32px;
        background: white;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .activity-details {
        flex: 1;
    }

    .activity-title {
        font-size: 0.9rem;
        color: #374151;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .activity-time {
        font-size: 0.8rem;
        color: #6b7280;
    }

    .no-activities {
        text-align: center;
        color: #9ca3af;
        padding: 2rem 1rem;
    }

    .no-activities i {
        margin-bottom: 0.5rem;
    }

    .no-activities p {
        margin: 0;
        font-size: 0.9rem;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
            grid-template-rows: auto auto auto auto;
            height: auto;
        }
    }
</style>

@section Scripts {
    <script>
        // Update current time every minute
        function updateCurrentTime() {
            var now = new Date();
            var timeString = now.getDate().toString().padStart(2, '0') + '/' + 
                           (now.getMonth() + 1).toString().padStart(2, '0') + '/' + 
                           now.getFullYear() + ' ' + 
                           now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentDateTime').textContent = timeString;
        }

        // Initialize time update
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000); // Update every minute
    </script>
}